package org.teamsparta.project5.service;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;

@Slf4j
@Component
@RequiredArgsConstructor
public class SampleItemDataLoader implements CommandLineRunner {

    private final DocumentService documentService;

    @Override
    public void run(String... args) {
        log.info("=== 샘플 RAG 문서 로딩 시작 ===");

        try {
            // 1. 제품 설치 가이드
//            String installGuide = """
//                    # 제품 설치 가이드
//                    1. 시스템 요구사항- 최소 메모리: 8GB- CPU: 듀얼코어 이상- OS: Windows 10 또는 Ubuntu 20.04 이상
//                    2. 설치 절차- 설치 파일 실행- 관리자 권한 승인- 설치 옵션 선택- 완료 후 재부팅
//                    3. 주의사항- 설치 중 프로그램을 종료하지 말 것.- 네트워크 연결 유지 필수.
//                    """;
//            addDocument("제품_설치_가이드.txt", installGuide);
//
//            // 2. 문제 해결 FAQ
//            String faq = """
//                    # 문제 해결 FAQ
//
//                    Q1. 실행이 되지 않습니다.
//                    A1. 관리자 권한으로 실행했는지 확인하세요.
//
//                    Q2. 네트워크 오류가 발생합니다.
//                    A2. 방화벽 설정에서 프로그램 권한을 허용해주세요.
//
//                    Q3. 설치 중 멈춤 현상이 발생합니다.
//                    A3. 백그라운드 프로그램을 모두 종료한 후 다시 시도하세요.
//
//                    """;
//            addDocument("문제_해결_FAQ.txt", faq);
//
//            // 3. API 사용법
//            String apiGuide = """
//                    # 제품 API 사용법
//
//                    ## 1. 인증 방식
//                    - API 키 기반 인증 사용
//                    - 요청 헤더: Authorization: Bearer {API_KEY}
//
//                    ## 2. 주요 API
//                    - GET /v1/status : 시스템 상태 조회
//                    - POST /v1/tasks : 작업 생성
//                    - GET /v1/tasks/{id} : 작업 상태 조회
//
//                    ## 3. 응답 구조
//                    {
//                      "status": "success",
//                      "data": {}
//                    }
//
//                    ## 4. 에러 처리
//                    - 401: 인증 실패
//                    - 403: 권한 없음
//                    - 404: 리소스 없음
//                    - 500: 서버 오류
//                    """;
//            addDocument("API_사용법.txt", apiGuide);
//
//            // 4. 운영 베스트 프랙티스
//            String bestPractices = """
//                    # 운영 베스트 프랙티스
//
//                    ## 1. 로그 정기 모니터링
//                    - 하루 1회 이상 시스템 로그 확인 권장
//
//                    ## 2. 데이터 백업
//                    - 매일 자동 백업 스케줄 실행 필요
//
//                    ## 3. 보안 정책
//                    - API 키는 3개월마다 교체
//                    - 관리자 계정 2FA 사용 필수
//
//                    ## 4. 문제 발생 시 조치
//                    - 오류 로그 확인
//                    - 시스템 재부팅
//                    - 미해결 시 지원팀 문의
//                    """;
//            addDocument("운영_베스트_프랙티스.txt", bestPractices);
//
//            // 5. 기능 개요
//            String features = """
//                    # 제품 기능 개요
//
//                    본 제품은 데이터 처리 자동화 기능을 제공하며 다음과 같은 주요 기능을 포함한다:
//
//                    ## 주요 기능
//                    1. 파일 업로드 자동 처리
//                    2. 실시간 로그 모니터링
//                    3. 자동 오류 탐지 및 복구 시도
//                    4. 다양한 데이터 형식 지원(JSON, XML, CSV)
//
//                    ## 고급 기능
//                    - AI 기반 예측 유지보수
//                    - 센서 데이터 실시간 분석
//                    - 클라우드 연동
//                    - 클러스터 구성 지원
//                    """;
//            addDocument("기능_개요.txt", features);
//
//            // 6. 제품 A1000 고급 기술 매뉴얼
//            String advancedManual = """
//                    # 제품 A1000 고급 기술 매뉴얼
//
//                    ## 1. 제품 개요
//                    제품 A1000은 기업용 스마트 자동화 솔루션으로 설계된 고성능 장비이다.
//                    AI 기반 검사 시스템, 실시간 센서 모니터링, 클라우드 연동 기능을 제공한다.
//
//                    ## 2. 하드웨어 사양
//                    - CPU: ARM 기반 8코어 프로세서
//                    - 스토리지: 기본 512GB SSD (최대 4TB 확장)
//                    - 네트워크: 듀얼 LAN 포트, 1Gbps 기본 / 10Gbps 확장
//                    - 센서 포트: 총 12개
//
//                    ## 3. 소프트웨어 구조
//                    - Linux 기반 OS
//                    - OTA 펌웨어 업데이트 지원
//                    - 웹 기반 관리자 모드 (HTTPS)
//
//                    ## 4. 유지보수
//                    - 정기 점검 주기: 6개월
//                    - MTBF: 50,000시간 이상
//                    - 원격 유지보수 옵션 제공
//                    """;
//            addDocument("제품A1000_고급_기술_매뉴얼.txt", advancedManual);
//
//            // 7. 제품 상세 매뉴얼
//            String installDetailGuide = """
//                    제품 설치 가이드 상세 매뉴얼
//
//                    1. 설치 전 준비 사항
//                    제품 설치 전에 반드시 공간의 크기, 전원 용량, 네트워크 환경을 확인해야 한다. 제품은 220V 전원을 사용하며, 추가적인 확장 모듈 사용 시 별도의 전원이 필요할 수 있다. 네트워크는 유선 LAN 연결을 권장하며, 무선 연결은 신호 강도 및 간섭에 따라 품질이 저하될 수 있다. 설치자는 제공된 체크리스트를 활용하여 필수 준비 사항을 확인해야 하며, 체크리스트는 제품 패키지의 설명서 뒤쪽에 포함되어 있다. 준비 사항을 충분히 확인하지 않고 설치를 진행할 경우 설치 품질이 저하되거나 제품 문제가 발생할 수 있다.
//
//                    2. 설치 절차 상세 설명
//                    설치는 반드시 제시된 순서에 따라 진행해야 한다. 먼저 본체를 설치할 위치에 고정한 후 전원 케이블과 네트워크 케이블을 연결한다. 그 다음 전원 버튼을 눌러 장치를 켜고 초기 화면이 표시될 때까지 대기한다. 초기화 과정에서는 언어 설정, 네트워크 설정, 관리자 계정 생성 단계가 순차적으로 진행된다. 설치자는 각 단계에서 화면의 안내 문구에 따라 정보를 정확히 입력해야 하며, 네트워크 설정 실패 시 재부팅 후 다시 시도해야 한다. 초기 설정이 완료되면 제품은 자동으로 최신 버전의 펌웨어 업데이트 여부를 확인한다.
//
//                    3. 설치 후 검증 절차
//                    설치 완료 후에는 테스트 모드로 진입하여 정상적으로 동작하는지 확인해야 한다. 테스트 모드에서는 네트워크 연결 테스트, 센서 작동 여부, 디스플레이 출력 상태, 내부 저장소 정상 여부 등을 자동으로 검사한다. 검사 결과는 설치 완료 보고서 형태로 PDF 파일로 저장되며, 이는 관리자 계정으로 다운로드할 수 있다. 만약 특정 항목에서 오류가 발생하면 해당 오류 코드에 따라 문제를 해결해야 한다. 오류 코드 목록은 제품 설명서 부록에 상세히 설명되어 있다.
//                    """;
//            addDocument("제품 상세 메뉴얼", installDetailGuide);
//
//            // 8. 문제 해결 FAQ
//            String faqDetail = """
//                    # 문제 해결 FAQ
//
//                    문제 해결 FAQ 상세 설명서
//
//                    1. 전원 관련 문제
//                    전원이 켜지지 않을 경우 먼저 전원 케이블이 본체와 콘센트에 제대로 연결되어 있는지 확인해야 한다. 전원 어댑터의 LED 표시등이 켜져 있는지 확인하고, 꺼져 있을 경우 다른 콘센트에 연결하여 전압 공급에 문제가 없는지 검사한다. 제품 내부의 안전장치가 작동한 경우 전원 공급이 차단될 수 있으며, 이 경우 10분 이상 전원을 분리한 뒤 다시 연결해야 한다. 만약 반복적으로 전원이 차단된다면 내부 회로 점검이 필요하므로 고객센터에 문의해야 한다.
//
//                    2. 네트워크 연결 문제
//                    네트워크 연결 오류가 발생하면 우선 네트워크 케이블의 연결 상태와 라우터의 정상 작동 여부를 확인해야 한다. 네트워크 장비의 재부팅이 필요한 경우가 많으며, 특히 동일 네트워크 대역 내 IP 충돌이 발생할 때 연결이 불안정할 수 있다. 무선 네트워크 사용 시 신호 세기와 간섭 여부를 확인하며, 전자레인지나 Bluetooth 기기와의 간섭이 원인이 될 수 있다. 관리자 메뉴의 네트워크 테스트 기능을 활용하여 패킷 손실률과 지연 시간을 측정할 수 있다.
//
//                    3. 디스플레이 관련 문제
//                    화면이 나오지 않는 경우 밝기 설정이 낮아진 것은 아닌지 확인한다. 특정 모델에서는 절전 모드 진입 시 화면이 자동으로 꺼지며, 이때 전원 버튼을 두 번 눌러 깨울 수 있다. 그래픽 모듈 오류가 발생하는 경우 화면에 잡음이나 깜빡임이 나타날 수 있으며, 이 경우 시스템 재시작으로 문제를 해결할 수 있다. 지속적으로 문제가 발생하면 디스플레이 모듈 교체가 필요할 수 있으며, 서비스 센터에 문의해야 한다.
//
//                    4. 오작동 및 센서 문제
//                    센서 오류가 발생하면 센서 위치에 먼지나 이물질이 있는지 확인하고, 부드러운 천으로 닦아낸다. 특정 환경에서는 온도, 습도, 조도 등의 외부 요인으로 인해 센서가 비정상적으로 동작할 수 있다. 센서 캘리브레이션 기능을 실행하여 정상 범위로 조정할 수 있으며, 조정 후에도 문제가 지속되면 센서 모듈 점검이 필요하다.
//
//                    """;
//            addDocument("문제_해결_FAQ.txt", faqDetail);

            log.info("=== 샘플 RAG 문서 로딩 완료: 총 8개 문서 ===");

        } catch (Exception e) {
            log.error("샘플 데이터 로딩 실패: {}", e.getMessage(), e);
        }
    }

    private void addDocument(String filename, String content) {
        try {
            documentService.addTextDocument(filename, content);
            log.info("✓ 문서 추가 완료: {}", filename);
        } catch (Exception e) {
            log.error("✗ 문서 추가 실패: {} - {}", filename, e.getMessage());
        }
    }
}
